(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function s(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(e){if(e.ep)return;e.ep=!0;const i=s(e);fetch(e.href,i)}})();class F{constructor(){this.keys={}}keyDown(t){this.keys[t.key]=!0}keyUp(t){this.keys[t.key]=!1}isKeyDown(t){return!!this.keys[t]}}class d{constructor(t,s,r,e,i){this.image=t,this.frameWidth=s,this.frameHeight=r,this.frameCount=e,this.frameRate=i,this.currentFrame=0,this.elapsedTime=0}update(t){this.elapsedTime+=t;const s=1/this.frameRate;for(;this.elapsedTime>=s;)this.currentFrame=(this.currentFrame+1)%this.frameCount,this.elapsedTime-=s}draw(t,s,r,e=1){const i=this.currentFrame*this.frameWidth;t.drawImage(this.image,i,0,this.frameWidth,this.frameHeight,s,r,this.frameWidth*e,this.frameHeight*e)}}class K{constructor(t,s,r){this.moveCooldown=30,this.lastMoveTime=0,this.moveSpeed=.16,this.zoom=1.5,this.currentDirection="down",this.gridX=t,this.gridY=s;const e=32,i=32,n=4,o=6;this.animations={up:new d(r.player_up,e,i,n,o),down:new d(r.player_down,e,i,n,o),left:new d(r.player_left,e,i,n,o),right:new d(r.player_right,e,i,n,o),upleft:new d(r.player_upleft,e,i,n,o),upright:new d(r.player_upright,e,i,n,o),downleft:new d(r.player_downleft,e,i,n,o),downright:new d(r.player_downright,e,i,n,o)},this.currentAnimation=this.animations[this.currentDirection]}update(t,s,r,e){let i=null;t.isKeyDown("ArrowUp")&&t.isKeyDown("ArrowLeft")?i="upleft":t.isKeyDown("ArrowUp")&&t.isKeyDown("ArrowRight")?i="upright":t.isKeyDown("ArrowDown")&&t.isKeyDown("ArrowLeft")?i="downleft":t.isKeyDown("ArrowDown")&&t.isKeyDown("ArrowRight")?i="downright":t.isKeyDown("ArrowUp")?i="up":t.isKeyDown("ArrowDown")?i="down":t.isKeyDown("ArrowLeft")?i="left":t.isKeyDown("ArrowRight")&&(i="right"),i&&i!==this.currentDirection&&(this.currentDirection=i,this.currentAnimation=this.animations[this.currentDirection]);const n=t.isKeyDown("ArrowUp")||t.isKeyDown("ArrowDown")||t.isKeyDown("ArrowLeft")||t.isKeyDown("ArrowRight");e!==void 0&&(n?this.currentAnimation.update(e):(this.currentAnimation.currentFrame=0,this.currentAnimation.elapsedTime=0));const o=performance.now();if(o-this.lastMoveTime<this.moveCooldown)return;let h=0,l=0;if(t.isKeyDown("ArrowUp")&&(h+=-1,l+=-1),t.isKeyDown("ArrowDown")&&(h+=1,l+=1),t.isKeyDown("ArrowLeft")&&(h+=-1,l+=1),t.isKeyDown("ArrowRight")&&(h+=1,l+=-1),h===0&&l===0)return;const f=Math.sqrt(h*h+l*l),p=h/f,m=l/f,w=this.moveSpeed,T=1/3,W=s.map[0].length-2,k=s.map.length-2,L=this.gridX+p*w,E=this.gridY+m*w;let u=this.gridX,y=this.gridY;const H={x:L,y:this.gridY,width:1,height:1};let A=!1;for(const c of r??[])if(c!==this&&"getBounds"in c&&typeof c.getBounds=="function"){const D=c.getBounds();if(this.isColliding(H,D)){A=!0;break}}A||(u=L);const R=A?this.gridY+m*w*T:E,B={x:u,y:R,width:1,height:1};let C=!1;for(const c of r??[])if(c!==this&&"getBounds"in c&&typeof c.getBounds=="function"){const D=c.getBounds();if(this.isColliding(B,D)){C=!0;break}}C||(y=R),u=Math.max(0,Math.min(u,W)),y=Math.max(0,Math.min(y,k)),this.gridX=u,this.gridY=y,this.lastMoveTime=o}render(t,s,r){const e=t.canvas.width/2,i=50,n=e+(this.gridX-this.gridY)*(s/2),o=i+(this.gridX+this.gridY)*(r/2);t.save();const h=this.currentAnimation.frameWidth+15,l=this.currentAnimation.frameHeight+5,f=n-h/2,p=o+r/2-l;this.currentAnimation.draw(t,f,p,this.zoom),t.restore()}isColliding(t,s){return t.x<s.x+s.width&&t.x+t.width>s.x&&t.y<s.y+s.height&&t.y+t.height>s.y}getBounds(){return{x:this.gridX,y:this.gridY,width:1,height:1}}}class U{constructor(t=[]){this.entities=t}addEntity(t){Array.isArray(t)?this.entities.push(...t):this.entities.push(t)}update(t,s,r){for(const e of this.entities)e instanceof K?e.update(t,s,this.entities,r):e.update(t,s)}render(t,s,r){this.entities.sort((e,i)=>{const n=e.gridX+e.gridY,o=i.gridX+i.gridY;return n-o}),this.entities.forEach(e=>{e.render(t,s,r)})}}class b{constructor(t,s,r){this.tileWidth=32,this.tileHeight=32,this.gridX=t,this.gridY=s;const e=Math.floor(Math.random()*r.length);this.image=r[e]}update(t,s){}getBounds(){return{x:this.gridX,y:this.gridY,width:.5,height:.5}}render(t,s,r){const e=t.canvas.width/2,i=50,n=e+(this.gridX-this.gridY)*(s/2),o=i+(this.gridX+this.gridY)*(r/2);t.drawImage(this.image,n-this.tileWidth/2,o-this.tileHeight/2,this.tileWidth,this.tileHeight)}}class O{constructor(t){this.tileWidth=40,this.tileHeight=20,this.images=t,this.map=this.generateMap()}generateMap(){const r=[];for(let e=0;e<19;e++){const i=[];for(let n=0;n<19;n++){let o;const h=e===18&&n===0,l=e===0&&n===18,f=e===18,p=n===18,m=e===18&&n===18;if(h)o="edgeTopLeft";else if(l)o="edgeTopRight";else if(m)o="edgeCenter";else if(f)o="edgeLeft";else if(p)o="edgeRight";else{const w=["grass1","grass2","grass3"];o=w[Math.floor(Math.random()*w.length)]}i.push(o)}r.push(i)}return r}render(t){const s=t.canvas.width/2,r=50;for(let e=0;e<this.map.length;e++)for(let i=0;i<this.map[e].length;i++){const n=this.map[e][i],o=this.images[n];if(!o)continue;const h=s+(i-e)*(this.tileWidth/2),l=r+(i+e)*(this.tileHeight/2);t.drawImage(o,h-this.tileWidth/2,l,this.tileWidth,this.tileHeight)}}}function P(a){const t=new O(a.tiles),s=new U([new K(9,9,a.player)]),r=[];for(let e=0;e<18;e++)for(let i=0;i<18;i++)if(Math.random()<.02){const n=new b(i,e,Object.values(a.rocks));r.push(n)}return s.addEntity(r),{tileMap:t,entities:s}}class q{constructor(t,s){this.lastTime=0,this.input=new F,this.ctx=t,this.assets=s;const{tileMap:r,entities:e}=P(s);this.tileMap=r,this.entities=e,window.addEventListener("keydown",i=>this.input.keyDown(i)),window.addEventListener("keyup",i=>this.input.keyUp(i))}start(){requestAnimationFrame(t=>this.loop(t))}loop(t){const s=(t-this.lastTime)/1e3;this.lastTime=t,this.update(s),this.render(),requestAnimationFrame(r=>this.loop(r))}update(t){this.entities.update(this.input,this.tileMap,t)}render(){this.ctx.clearRect(0,0,800,600),this.tileMap.render(this.ctx),this.entities.render(this.ctx,this.tileMap.tileWidth,this.tileMap.tileHeight)}}async function Y(a){const t={},s=Object.entries(a).map(([r,e])=>new Promise((i,n)=>{const o=new Image;o.src=e,o.onload=()=>{t[r]=o,i()},o.onerror=()=>n(`Failed to load image: ${e}`)}));return await Promise.all(s),t}async function z(){const a=await Y(S),t=await Y(N),s=await Y($);return{tiles:a,rocks:t,player:s}}const S={grass1:"assets/tiles/grass1.png",grass2:"assets/tiles/grass2.png",grass3:"assets/tiles/grass3.png",edgeLeft:"assets/tiles/edgeLeft.png",edgeTopLeft:"assets/tiles/edgeTopLeft.png",edgeRight:"assets/tiles/edgeRight.png",edgeTopRight:"assets/tiles/edgeTopRight.png",edgeCenter:"assets/tiles/edgeCenter.png"},N={rock1:"assets/obstacles/rock1.png"},$={player_up:"assets/player/Character_Up.png",player_upleft:"assets/player/Character_UpLeft.png",player_upright:"assets/player/Character_UpRight.png",player_down:"assets/player/Character_Down.png",player_downleft:"assets/player/Character_DownLeft.png",player_downright:"assets/player/Character_DownRight.png",player_left:"assets/player/Character_Left.png",player_right:"assets/player/Character_Right.png"},g=document.createElement("canvas"),X=800,v=600;g.width=X;g.height=v;g.style.position="relative";g.style.imageRendering="pixelated";function _(){const a=Math.min(window.innerWidth/X,window.innerHeight/v);g.style.width=`${X*a}px`,g.style.height=`${v*a}px`}_();window.addEventListener("resize",_);const M=document.getElementById("board");M==null||M.appendChild(g);const x=g.getContext("2d");if(!x)throw new Error("Canvas context not available");z().then(a=>{new q(x,a).start()});
